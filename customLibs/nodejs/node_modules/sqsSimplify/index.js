const AWS = require("aws-sdk");
const sqs = new AWS.SQS();

const receiveMessage = async (queueUrl) => {
  const params = {
    QueueUrl: queueUrl,
    MaxNumberOfMessages: 1,
    WaitTimeSeconds: 1,
  };
  const messages = await sqs.receiveMessage(params).promise();

  if (!messages || messages.Messages == undefined || messages.Messages == null) {
    console.log("Nenhuma mensagem recebida.");
    return 500;
  } else {
    const message = messages.Messages[0];
    const messageBody = message.Body;
    console.log("Mensagem recebida: " + messageBody);
    return message;
  }
};

const deleteMessage = async (queueUrl, message) => {
  const params = {
    QueueUrl: queueUrl,
    ReceiptHandle: message.ReceiptHandle,
  };
  await sqs.deleteMessage(params).promise();
  console.log("message: " + message.Body + " deleted");
};

const sendMessage = async (queueUrl, message) => {
  const params = {
    QueueUrl: queueUrl,
    MessageBody: message,
  };
  await sqs.sendMessage(params).promise();
};

module.exports = {
  receiveMessage,
  deleteMessage,
  sendMessage,
};
